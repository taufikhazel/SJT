<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>SJT</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="../styles.css" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link rel="stylesheet" href="../styles.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #fcd98d;
      font-family: Arial, Helvetica, sans-serif;
    }

    .container {
      width: 800px;
      margin: 100px auto;
      border: 1px solid #ccc;
      padding: 20px;
      background-color: white;
      display: flex;
      flex-direction: column;
      border-radius: 10px;
    }

    input {
      width: 380px;
      padding: 14px;
      margin: 10px 0;
      border: 1px solid #ccc;
      box-sizing: border-box;
      background: rgb(238, 226, 203);
      border-radius: 7px;
    }

    a {
      text-decoration: none;
      color: #000;
      font-size: 20px;
    }

    a:hover {
      text-decoration: underline black;
      font: bold;
    }
  </style>
</head>

<body>
  <header>
    <nav>
      <div class="logo">
        <img src="../../src/logo.png" alt="Logo" />
      </div>
      <ul class="nav-links">
        <h2><b>Sukses Jaya Transporindo </b></h2>
        <li>
          <span class="material-symbols-outlined" id="notification">
            notifications
          </span>
          <div id="myModal" class="modal">
            <div class="modal-content">
              <div class="modal-header">
                <span class="close">&times;</span>
              </div>
              <div class="modal-body">
                <h2>Notifikasi</h2>
                <p style="color: rgb(181, 181, 181);">Notifikasi/Pemberitahuan</p>
                <br>
                <div class="containerIsiNotifikasi"></div>
              </div>
            </div>
          </div>
        </li>
      </ul>
      <div class="dropdown">
        <button class="login-btn" id="btnUser"></button>
        <div id="dropdownMenu" class="dropdown-content">
          <button id="btnLogout">Logout</button>
        </div>
      </div>
    </nav>
  </header>
  <div class="container">
    <h2 class="tgl-rental">Tanggal Rental</h2>
    <p class="info-tgl">Pilih tanggal rental anda.</p>
    <p class="step">Step 2 of 4</p>
    <div class="input-tanggalcl">
      <input type="radio" class="input-tanggal" checked="checked" name="input-tanggal" value="input-tanggal" />
      <label class="input-tanggal">Input Tanggal</label>
      <div class="isi-tanggal">
        <h3 class="tanggal-txt">Tanggal</h3>
        <div id="tanggalInputsContainer">
          <input type="date" placeholder="isi Tanggal" class="tanggalInput" />
        </div>
        <button type="button" id="addDateBtn">Add Another Date</button>
        <button type="button" id="removeDateBtn">Remove Last Date</button>
        <div class="next2">
          <button class="next-btn2" id="nextBtn">Next</button>
        </div>
      </div>
    </div>
  </div>


  <div id="loaderPopup" class="popup">
    <p>Mohon tunggu...</p>
  </div>

  <div id="confirmationPopup" class="popup">
    <p>Apakah anda yakin ingin logout?</p>
    <button class="confirmBtn" onclick="confirmLogout(true)">Iya</button>
    <button class="confirmBtn" onclick="confirmLogout(false)">Tidak</button>
  </div>

  <script>
    // const dateInput = document.getElementById("tanggalInput");

    // const today = new Date();
    // const year = today.getFullYear();
    // const month = String(today.getMonth() + 1).padStart(2, '0');
    // const day = String(today.getDate()).padStart(2, '0');
    // const formattedToday = `${year}-${month}-${day}`;

    // dateInput.setAttribute("min", formattedToday);

    var modal = document.getElementById("myModal");
    var spanNotif = document.getElementById("notification");
    var span = document.getElementsByClassName("close")[0];

    spanNotif.onclick = function () {
      modal.style.display = "block";
    };

    span.onclick = function () {
      modal.style.display = "none";
    };

    window.onclick = function (event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    };

    function updateButtonText() {
      const btnUser = document.getElementById("btnUser");
      const user = JSON.parse(sessionStorage.getItem("loggedInUser"));

      if (user && user.username) {
        btnUser.textContent = "Hi, " + user.username + "!";
      } else {
        alert("Anda Perlu Login, Silahkan Login Kembali!");
        window.location.href = "../logUser.html";
        sessionStorage.clear();
      }
    }

    document.getElementById("btnUser").addEventListener("click", function () {
      const dropdownMenu = document.getElementById("dropdownMenu");
      dropdownMenu.classList.toggle("show");
    });

    document
      .getElementById("btnLogout")
      .addEventListener("click", function () {
        document.getElementById("confirmationPopup").style.display = "block";
      });

    function confirmLogout(confirmed) {
      if (confirmed) {
        sessionStorage.removeItem("loggedInUser");
        sessionStorage.removeItem("transaksiData");
        window.location.href = "../logUser.html";
      } else {
        document.getElementById("confirmationPopup").style.display = "none";
      }
    }
    window.onclick = function (event) {
      if (!event.target.matches("#btnUser")) {
        const dropdowns = document.getElementsByClassName("dropdown-content");
        for (let i = 0; i < dropdowns.length; i++) {
          const openDropdown = dropdowns[i];
          if (openDropdown.classList.contains("show")) {
            openDropdown.classList.remove("show");
          }
        }
      }
    };

    window.onload = updateButtonText;


    document.getElementById("nextBtn").disabled = true;

    const nextBtn = document.getElementById("nextBtn");
    const addDateBtn = document.getElementById("addDateBtn");
    const removeDateBtn = document.getElementById("removeDateBtn");
    const tanggalInputsContainer = document.getElementById("tanggalInputsContainer");

    function updateNextButtonState() {
      const inputs = document.querySelectorAll(".tanggalInput");
      const allFilled = Array.from(inputs).every((input) => input.value.trim() !== "");
      nextBtn.disabled = !allFilled;
    }

    function addDateInput() {
      const newDateInput = document.createElement("input");
      newDateInput.type = "date";
      newDateInput.placeholder = "isi Tanggal";
      newDateInput.classList.add("tanggalInput");
      newDateInput.addEventListener("input", updateNextButtonState);
      tanggalInputsContainer.appendChild(newDateInput);
      updateNextButtonState();
    }

    function removeDateInput() {
      const dateInputs = document.querySelectorAll(".tanggalInput");
      if (dateInputs.length > 1) {
        tanggalInputsContainer.removeChild(dateInputs[dateInputs.length - 1]);
      }
      updateNextButtonState();
    }

    addDateBtn.addEventListener("click", addDateInput);
    removeDateBtn.addEventListener("click", removeDateInput);

    document.querySelectorAll(".tanggalInput").forEach((input) => {
      input.addEventListener("input", updateNextButtonState);
    });

    nextBtn.addEventListener("click", async function () {
      if (sessionStorage) {
        let transaksiData = JSON.parse(sessionStorage.getItem("transaksiData")) || {};
        let tanggalValues = [];
        document.querySelectorAll(".tanggalInput").forEach((input) => {
          if (input.value.trim()) {
            tanggalValues.push(input.value.trim());
          }
        });
        transaksiData.tanggal = tanggalValues;
        sessionStorage.setItem("transaksiData", JSON.stringify(transaksiData));
        window.location.href = "user3.html";
      } else {
        alert("Gagal menghasilkan ID Transaksi baru. Silakan coba lagi.");
      }
    });

    updateNextButtonState();

    // document.getElementById("nextBtn").disabled = true;
    // const inputs = document.querySelectorAll(".isi-tanggal input");
    // const nextBtn = document.getElementById("nextBtn");

    // inputs.forEach((input) => {
    //   input.addEventListener("input", checkFields);
    // });

    // function checkFields() {
    //   const allFilled = Array.from(inputs).every(
    //     (input) => input.value.trim() !== ""
    //   );
    //   nextBtn.disabled = !allFilled;
    // }

    // nextBtn.addEventListener("click", async function () {
    //   if (sessionStorage) {
    //     let transaksiData =
    //       JSON.parse(sessionStorage.getItem("transaksiData")) || {};
    //     let tanggalValue = "";
    //     inputs.forEach((input) => {
    //       tanggalValue += input.value.trim();
    //     });
    //     transaksiData.tanggal = tanggalValue;
    //     sessionStorage.setItem(
    //       "transaksiData",
    //       JSON.stringify(transaksiData)
    //     );
    //     window.location.href = "user3.html";
    //   } else {
    //     alert("Gagal menghasilkan ID Transaksi baru. Silakan coba lagi.");
    //   }
    // });
    //Logika Notifikasi
    // Mengambil idUser dari sessionStorage
    const loggedInUser = JSON.parse(sessionStorage.getItem('loggedInUser'));
    const idUser = loggedInUser.idUser;
    fetch('../data/transaksi.json')
      .then(response => response.json())
      .then(data => {
        const userTransaksi = data.filter(transaksi => transaksi.idUser === idUser);

        if (userTransaksi.length > 0) {
          generateModalContent(userTransaksi);
        } else {
          console.log("Tidak ada data yang cocok untuk idUser:", idUser);
        }
      })
      .catch(error => console.error('Error fetching data:', error));
    function generateModalContent(transaksiList) {
      const isiNotifikasiContainer = document.querySelector('.containerIsiNotifikasi');
      isiNotifikasiContainer.innerHTML = '';

      let isBelumDiprosesFound = false;

      transaksiList.forEach(transaksi => {
        if (transaksi.status === "Belum Diproses") {
          isBelumDiprosesFound = true;
        }

        const newIsiNotifikasiDiv = document.createElement('div');
        newIsiNotifikasiDiv.classList.add('isiNotifikasi');

        const radioButtonDiv = document.createElement('div');
        radioButtonDiv.classList.add('radioButton');

        if (transaksi.status === "Belum Diproses") {
          const radioButton = document.createElement('input');
          radioButton.type = 'radio';
          radioButton.classList.add('rbtn');
          radioButtonDiv.appendChild(radioButton);
        } else {
          const checkCircleSpan = document.createElement('span');
          checkCircleSpan.className = 'material-symbols-outlined';
          checkCircleSpan.textContent = 'check_circle';
          checkCircleSpan.id = "success";
          radioButtonDiv.appendChild(checkCircleSpan);
        }

        const textNotifikasiDiv = document.createElement('div');
        textNotifikasiDiv.classList.add('textNotifikasi');

        const idTransaksiLink = document.createElement('p');
        idTransaksiLink.href = '#';
        idTransaksiLink.id = 'idTransaksi';
        idTransaksiLink.textContent = `Kode Pesanan: ${transaksi.idTransaksi}`;

        const tanggalLink = document.createElement('p');
        tanggalLink.href = '#';
        tanggalLink.id = 'tanggal';
        tanggalLink.textContent = `Tanggal jatuh tempo: ${transaksi.tanggal}`;

        textNotifikasiDiv.appendChild(idTransaksiLink);
        textNotifikasiDiv.appendChild(document.createElement('br'));
        textNotifikasiDiv.appendChild(tanggalLink);

        if (transaksi.status === "Belum Diproses") {
          const unsuccess = document.createElement('span');
          unsuccess.className = "material-symbols-outlined";
          unsuccess.id = 'unSuccess';
          unsuccess.textContent = 'error';
          textNotifikasiDiv.appendChild(unsuccess);
        }

        newIsiNotifikasiDiv.appendChild(radioButtonDiv);
        newIsiNotifikasiDiv.appendChild(textNotifikasiDiv);

        isiNotifikasiContainer.appendChild(newIsiNotifikasiDiv);
      });

      const notificationIcon = document.getElementById('notification');

      if (isBelumDiprosesFound) {
        notificationIcon.textContent = 'notification_important';
        notificationIcon.style.color = '#EA3323';
      } else {
        notificationIcon.textContent = 'notifications';
        notificationIcon.style.color = '#000';
      }

      const modalBody = document.querySelector('.modal-body');
      modalBody.style.overflowY = 'auto';
      modalBody.style.maxHeight = '400px';
    }
  </script>
</body>

<!-- Site footer -->
<footer>
  <div class="containerFooter">
    <div class="parentFooter">
      <div class="contentFooter">
        <h1>Company</h1>
        <p style="font-size: 12px;">PT SUKSES JAYA TRANSPORINDO</p>
      </div>
      <div class="contentFooter">
        <h1>Social</h1>
        <p style="font-size: 12px;">PT SUKSES JAYA TRANSPORINDO</p>
      </div>
      <div class="contentFooter">
        <h1>Layanan</h1>
        <p style="font-size: 12px;">PT SUKSES JAYA TRANSPORINDO</p> 
      </div>
    </div>
    <hr>
      <p class="copyright">PT SUKSES JAYA TRANPORINDO</p>
  </div>
</footer>


</html>